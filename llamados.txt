select l.nombre_libro
from perfil_libro_fav plf, libro l, perfil p
where p.nombre = 'Juan PÃ©rez' and p.rut = plf.rut and plf.libro_is_fav = true
and plf.id_libro = l.id_libro

SELECT l.nombre_libro, ROW_NUMBER() OVER (ORDER BY COUNT(*) DESC) AS ranking, COUNT(*) AS contador
FROM perfil_libro_fav plf, libro l
WHERE plf.Libro_is_fav = true and plf.ID_libro = l.ID_libro
GROUP BY l.ID_libro
ORDER BY contador DESC;